<meta name="viewport" content="width=device-width, initial-scale=1.0">


<div class="KanjiLookup--dark">
  <div class="KanjiLookup-container productionCard-front">
    <h1 class="keyword" id="keywords_front"></h1>
    <h1 class="keyword" id="meanings_front"></h1>
    <div id="words_front"></div>
  </div>
</div>


<div id="migaku_data">{{MigakuData}}</div>
<script>
  function wrap_list(list, intro, outro)
  {
    if (list.length < 1)
      return '-';
    return intro + list.join(outro+intro) + outro;
  }

  var data_b64 = document.getElementById('migaku_data').innerHTML;
  data_b64 = data_b64.replace( /(<([^>]+)>)/ig, '');  // Needed because of Migaku Editor :|
  var data_json = atob(data_b64);
  var data = JSON.parse(data_json);

  var max_words_front = 4;
  var max_words = max_words_front;
  var word_pts = [];
  var word_front_pts = [];

  for (var i = 0; i < data.words.length; i++)
  {
    if (word_pts.length >= max_words)
        break;

    const we = data.words[i];
    const w = we[0];
    const r = we[1];

    word_pts.push('<button class="word" data-word-idx="' + i + '"><ruby>' + w + '<rt>' + r + '</rt></ruby></button>')
    if (word_front_pts.length < max_words_front)
      word_front_pts.push('<div class="word_front"><ruby>' + w + '<rt>' + r + '</rt></ruby></div>');
  }
  for (var i = 0; i < data.words_default.length; i++)
  {
    if (word_pts.length >= max_words)
        break;

    const we = data.words_default[i];
    const w = we[0];
    const r = we[1];

    if (data.words.some(
      function(existing_we) { return (w == existing_we[0] && r == existing_we[1]); }
    ))
      continue;

    word_pts.push('<button class="word word_default"><ruby>' + w + '<rt>' + r + '</rt></ruby></button>')
    if (word_front_pts.length < max_words_front)
      word_front_pts.push('<div class="word_front"><ruby>' + w + '<rt>' + r + '</rt></ruby></div>');
  }
  $('.KanjiLookup-words').toggle(word_pts.length > 0);
  $('#words').html(word_pts.join(''));
  $('#words_front').html(word_front_pts.join('').split(data.character).join('ï¼¿'));

  var keywords = [];
  if (data.usr_keyword)
    keywords.push(data.usr_keyword);
  if (data.heisig_keyword5 && !keywords.includes(data.heisig_keyword5))
    keywords.push(data.heisig_keyword5);
  if (data.heisig_keyword6 && !keywords.includes(data.heisig_keyword6))
    keywords.push(data.heisig_keyword6);
  keywords_txt = keywords.length ? keywords.join(', ') : '-';
  $('#keywords').html(keywords_txt);
  if (keywords.length)
    $('#keywords_front').html(keywords_txt);

  var meanings_txt = data.meanings.length ? data.meanings.join(', ') : '-';
  $('#meanings').html(meanings_txt);
  if (data.meanings.length)
    $('#meanings_front').html(meanings_txt);
</script>
