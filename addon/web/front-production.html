<!-- ======================
START - Migaku markup
- @version v0.9.8
======================= -->

<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- START - Migaku header -->
<div class="migaku-header">
	<img class="migaku-header__logo" src="_migaku-logo.svg" alt="Logo" />
</div>
<!-- END - Migaku header -->

<div class="layout__container">
	<div class="layout__above">
		<!-- START - Character and examples -->
		<div class="character-and-examples__container">
			<h1 id="keywords_front" class="character-and-examples__keyword"></h1>

			<div
				id="words_front"
				class="
					character-and-examples__list character-and-examples__example-words
					kanji-char-font
				"
			></div>
		</div>
		<!-- END - Character and examples -->
	</div>

	<main class="layout__main">
		<div class="layout__content"></div>

		<aside class="layout__aside"></aside>
	</main>

	<div class="layout__below"></div>

	<!-- START - Migaku data -->
	<div id="migaku_data">{{MigakuData}}</div>
	<!-- START - Migaku end -->
</div>

<!-- START - Addon script, Production, front -->
<!-- NOTE: Unchanged -->
<script>
	function wrap_list(list, intro, outro) {
		if (list.length < 1) return '-';
		return intro + list.join(outro + intro) + outro;
	}

	var data_b64 = document.getElementById('migaku_data').innerHTML;
	data_b64 = data_b64.replace(/(<([^>]+)>)/gi, ''); // Needed because of Migaku Editor :|
	var data_json = atob(data_b64);
	var data = JSON.parse(data_json);

	var max_words_front = settings.words_max;
	var max_words = max_words_front;
	var word_pts = [];
	var word_front_pts = [];

	for (var i = 0; i < data.words.length; i++) {
		if (word_pts.length >= max_words) break;

		const we = data.words[i];
		const w = we[0];
		const r = we[1];

		word_pts.push(
			'<button class="word" data-word-idx="' +
				i +
				'"><ruby>' +
				w +
				'<rt>' +
				r +
				'</rt></ruby></button>',
		);
		if (word_front_pts.length < max_words_front)
			word_front_pts.push(
				'<div class="word_front"><ruby>' +
					w +
					'<rt>' +
					r +
					'</rt></ruby></div>',
			);
	}
	for (var i = 0; i < data.words_default.length; i++) {
		if (word_pts.length >= max_words) break;

		const we = data.words_default[i];
		const w = we[0];
		const r = we[1];

		if (
			data.words.some(function (existing_we) {
				return w == existing_we[0] && r == existing_we[1];
			})
		)
			continue;

		word_pts.push(
			'<button class="word word_default"><ruby>' +
				w +
				'<rt>' +
				r +
				'</rt></ruby></button>',
		);
		if (!settings.hide_default_words && word_front_pts.length < max_words_front)
			word_front_pts.push(
				'<div class="word_front word_front_default"><ruby>' +
					w +
					'<rt>' +
					r +
					'</rt></ruby></div>',
			);
	}
	$('.KanjiLookup-words').toggle(word_pts.length > 0);
	$('#words').html(word_pts.join(''));
	$('#words').toggleClass('hide_readings_hover', settings.hide_readings_hover);
	$('#words_front').html(
		word_front_pts.join('').split(data.character).join('ï¼¿'),
	);

	if (settings.hide_keywords && word_front_pts.length > 0)
		document.getElementById('keywords_front').style.display = 'none';

	var keywords = [];
	if (data.usr_keyword) keywords.push(data.usr_keyword);
	if (!settings.only_custom_keywords || keywords.length < 1) {
		if (data.heisig_keyword5 && !keywords.includes(data.heisig_keyword5))
			keywords.push(data.heisig_keyword5);
		if (data.heisig_keyword6 && !keywords.includes(data.heisig_keyword6))
			keywords.push(data.heisig_keyword6);
		for (const pk of data.primitive_keywords) {
			if (!keywords.includes(pk))
				keywords.push('<span class="primitive_keyword">' + pk + '</span>');
		}
	}
	keywords_txt = keywords.length ? keywords.join(', ') : '-';
	$('#keywords').html(keywords_txt);
	if (keywords.length < 1) keywords = data.meanings;
	keywords_front_txt = keywords.length ? keywords.join(', ') : '-';
	$('#keywords_front').html(keywords_front_txt);

	if (!settings.show_readings_front) $('rt').css({ visibility: 'hidden' });
</script>
<!-- END - Addon script, Production, front -->

<!-- ======================
END - Migaku markup
======================= -->
